# Consultando dados do solicitante

## Objetivo

Devemos consultar alguns dados financeiros do solicitante afim de validar se sera possivel oferecer um cartão.

### Necessidades

Antes de provisionar um cartão para o solicitante, devemos verificar se o mesmo possui restrições. Passar o argumento documento para o sistema de avaliação.
Consultar o parceiro, disponível no endereço http://analise.financeira.nosso.cartao/avaliacao e com base no resultado aplicar as regras. (POST)

### Restrições

O documento deve ser passado no body da requisição por motivo de segurança, header and query parameters nao sao criptografados
- CPF/CNPJ

### Resultado Esperado

No processo de Criação da Proposta deve considerar o status recebido da avaliação financeira do solicitante.
-  Caso a devolutiva da analise for o estado **COM_RESTRICAO** o estado da proposta deve ser **NAO_ELEGIVEL**
-  Caso a devolutiva da analise for o estado **SEM_RESTRICAO** o estado da proposta deve ser **ELEGIVEL**

## Informações de suporte

- Esta com dúvida de como consumir um determinado serviço? Primeiro precisamos analisar se ele possui algum tipo de 
documentação que nos instrua a utilizá-lo. Nosso serviço de analise financeira utiliza um padrão para documentação 
chamado OpenAPI. [A documentação pode ser encontrada aqui](link) **FIXME CLAUDIO**

* Está com dúvida, sobre o formato de documentação das APIs do serviço de analise financeira? [Aqui tem uma explicação do que entendemos que você deve considerar!](http://spec.openapis.org/oas/v3.0.3)
    
    * Teve dificuldade com a documentação? Não tem problema! [Aqui você encontra um playground para aprimorar sua habilidade!](https://editor.swagger.io/)

* Tem alguns status codes que não me lembro, [aqui você pode relembrá-los!!](../informacao_suporte/rest-status.md)

* Entendi a documentação como devo iniciar a implementação da integração. Existem algumas maneiras de ser implementar as chamadas para serviços REST
  * [Usando RestTemplate presente no Spring](../informacao_suporte/rest-template.md)
  * Também podemos usar o Feign que nos ajuda a criar clientes Rest de uma maneira mais prática.  
  * Ou ainda usar o [Webclient](../informacao_suporte/web-client.md)  
  
* Talvez esteja pensando, e se o endereço do sistema legado mudar, qual é a melhor prática a ser utilizada? Deixar fixo 
no código e mudar quando requisitado? [Aqui tem uma explicação do que entendemos que você deve considerar!](../informacao_procedural/twelve-factor-config.md)

## Sugestões de busca de conteúdo

Quando falamos de tecnologias, precisamos buscar as maiores autoridades no assunto para analisar o que aquelas pessoas 
pensaram quando criaram tal tecnologia. Aqui neste funcionalidade encostamos no Spring Schedule, Feign, etc. 

Claro que usamos apenas uma parte do que está lá, mas já vá se acostumando a ler as documentações das tecnologias. 
Vamos deixar aqui alguns links para você:

* [Feign](https://github.com/OpenFeign/feign)
* [RestTemplate](https://docs.spring.io/spring-android/docs/current/reference/html/rest-template.html)
* [The Twelve-Factor App](https://12factor.net/pt_br/)

## Informações para criação do conteúdo

### Claudio

I.P => Incluir configuração do endpoint via environment variable (12 factor)

I.P => Lembrar como tratar excecoes HTTP RestTemplate (Status Codes)

### Alberto

1. Para mim o cartão não está bem descrito, então fica a pergunta: 
   em qual momento isso acontece? É síncrono? Assíncrono? É necessário extrair o máximo de informação de uma funcionalidade para que a implementação seja limpa. Outra pergunta: Preciso ter histórico das tentativas de aprovação? Preciso saber a data? Precisamos ser bons em extrair coisas do dono do produto.
2. Para que seu código fique preparado para retorno assíncrono, você pode utilizar uma CompletableFuture. Dessa forma quem invoca sempre acha que é assíncrono. Mesmo que naquele momento você realmente não tenha nenhuma chamada demorada.
3. Quando você tem um objeto gerenciado na mão e promove uma alteração dentro de uma transação, o hibernate automaticamente aplica um update para você.
4. Eu tinha feito um código bug na hora de verificar o estado da avaliação de uma proposta. Só que como estava rodando em outra thread, eu acho que o spring estava engolindo a exception. Só na hora que eu coloquei o log para debug foi que apareceu a exception que meu código estava soltando e aí eu fui capaz de resolver.
5. Como configurar uma execução assíncrona dentro do Spring.

### Rafael Ponte

### Yuri

Transações assíncronas

Como salvar/mapear um enum no hibernate

ApplicationEventPublisher

@Component
@EventListener
@Async

https://cloud.spring.io/spring-cloud-netflix/multi/multi_spring-cloud-feign.html

12 factor apps - enviroment variables

https://www.alura.com.br/artigos/desvendando-o-dockerfile

https://www.youtube.com/watch?v=0xxHiOSJVe8&list=PLf-O3X2-mxDkiUH0r_BadgtELJ_qyrFJ_


### Luram Archanjo

Sugestão, adicionar caminho do Swagger

Sugestão, adicionar obrigatoriedade dos campos
