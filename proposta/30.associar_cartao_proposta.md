# Associar o cartão criado com a proposta

## Objetivo

Atrelar o número do cartão gerado a proposta. A proposta quando aprovada deve ser relacionada com um número do cartão.

O sistema de proposta deve consultar em tempo periódico o sistema de cartões a fim de obter o número do cartão gerada 
para as propostas que foram geradas com sucesso, porém ainda não tem o número do cartão atrelado.

#### Necessidades

Associar o número do cartão na proposta previamente criada com sucesso. O cartão deve ser persistido de acordo com as 
informações recebidas do sistema externo.

#### Restrições

Identificador da proposta será utilizado como base para consulta do cartão no sistema legado "accounts".

Para consultar se o cartão foi criado com sucesso, temos uma API específica para este fim, vamos analisá-la?

`http://localhost:8888/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/`

#### Resultado Esperado

- Quando o sistema de accounts(cartões) retornar sucesso (família 200) o número de cartão deve ser atrelado a proposta.

- Quando o sistema de accounts(cartões) retornar falha (família 400 ou 500) não atualizar o estado da proposta, pois 
ainda não foi processado, aguardar próxima iteração.

## Informações de suporte

**FIXME LURAM - Adicionar itens do Consultando dados do solicitante**

* Está em dúvida sobre o que significa a expressão "tempo periódico"? [Aqui tem uma explicação do que entendemos que você deve considerar!](../informacao_procedural/synchronous-vs-asynchronous.md)

* Está pensando em como associar o cartão em "tempo periódico"? Olha que interessante, já existe um projeto \ módulo no Spring 
que pensou só nisso! [Aqui você encontra como fazer isso !!!](https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#scheduling-enable-annotation-support)

    * Teve dificuldade com a documentação? Não tem problema! [Aqui você encontra como fazer isso !!!](../informacao_suporte/spring-schedule.md)
    
* Está pensando em como consultar as propostas com sucesso e sem cartão associado? [Aqui você encontra como fazer isso !!!](../informacao_suporte/spring-data-query-methods.md)
    
* Está pensando em como consultar se o cartão foi gerado com sucesso? Olha que interessante, já existe um projeto \ 
módulo no Spring que pensou só nisso! [Aqui você encontra como fazer isso !!!](https://cloud.spring.io/spring-cloud-openfeign/2.2.x/reference/html/#spring-cloud-feign)

    * Teve dificuldade com a documentação? Não tem problema! [Aqui você encontra como fazer isso !!!](../informacao_suporte/spring-schedule.md) **FIXME LURAM - Feign Cláudio**

## Sugestões de busca de conteúdo

Quando falamos de tecnologias, precisamos buscar as maiores autoridades no assunto para analisar o que aquelas pessoas 
pensaram quando criaram tal tecnologia. Aqui neste funcionalidade encostamos no Spring Schedule, Feign, etc. 

Claro que usamos apenas uma parte do que está lá, mas já vá se acostumando a ler as documentações das tecnologias. 
Vamos deixar aqui alguns links para você:

* [Spring Schedule](https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#scheduling-annotation-support)
* [Feign](https://github.com/OpenFeign/feign)
* [RestTemplate](https://docs.spring.io/spring-android/docs/current/reference/html/rest-template.html)
* [The Twelve-Factor App](https://12factor.net/pt_br/)

## Informações para criação do conteúdo

### Claudio

I.S => Consultar Documentação de APIs
       Usando docker-compose.yaml o endereço da API será
       http://localhost:8888/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config

I.S => entender conceitos de documentação de APIs OpenAPI/Swagger      
       Detalhar a importância de doc no consumo       

I.S => expiracao da busca do cartao?? fica infinito???

### Luram Archanjo

Sugestão, na API não tem um campo de número de cartão, portanto inferi que seria o id.

Sugestão, quando não passado o idProposta na API http://localhost:8888/api/cartoes dá erro genérico.

Sugestão, quando passado um idProposta inválido na API http://localhost:8888/api/cartoes dá erro 500.

Sugestão, talvez para um JR o mesmo não sabe o módulo de Scheduling do Spring ou conceito de pooling, etc.